{"ast":null,"code":"import { NavigationStart } from '@angular/router';\nimport { combineLatest, filter, map, Subject, takeUntil } from 'rxjs';\nimport { SocketEventsEnum } from 'src/app/shared/types/socketEvents.enum';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared/services/boards.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../services/board.service\";\nimport * as i4 from \"src/app/shared/services/socket.service\";\nimport * as i5 from \"src/app/shared/services/columns.service\";\nimport * as i6 from \"src/app/shared/services/tasks.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../../shared/modules/topbar/components/topbar/topbar.component\";\nimport * as i9 from \"../../../shared/modules/inlineForm/components/inlineForm/inlineForm.component\";\n\nfunction BoardComponent_div_1_div_6_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵlistener(\"click\", function BoardComponent_div_1_div_6_div_4_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const task_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r6.openTask(task_r5.id));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", task_r5.title, \" \");\n  }\n}\n\nfunction BoardComponent_div_1_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"div\", 9)(2, \"inline-form\", 10);\n    i0.ɵɵlistener(\"handleSubmit\", function BoardComponent_div_1_div_6_Template_inline_form_handleSubmit_2_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const column_r3 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.updateColumnName($event, column_r3.id));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"img\", 11);\n    i0.ɵɵlistener(\"click\", function BoardComponent_div_1_div_6_Template_img_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const column_r3 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r10.deleteColumn(column_r3.id));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(4, BoardComponent_div_1_div_6_div_4_Template, 2, 1, \"div\", 12);\n    i0.ɵɵelementStart(5, \"inline-form\", 13);\n    i0.ɵɵlistener(\"handleSubmit\", function BoardComponent_div_1_div_6_Template_inline_form_handleSubmit_5_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const column_r3 = restoredCtx.$implicit;\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.createTask($event, column_r3.id));\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const column_r3 = ctx.$implicit;\n    const data_r1 = i0.ɵɵnextContext().ngIf;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"defaultText\", column_r3.title)(\"title\", column_r3.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.getTasksByColumn(column_r3.id, data_r1.tasks));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"hasButton\", true);\n  }\n}\n\nfunction BoardComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"inline-form\", 3);\n    i0.ɵɵlistener(\"handleSubmit\", function BoardComponent_div_1_Template_inline_form_handleSubmit_2_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.updateBoardName($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 4);\n    i0.ɵɵlistener(\"click\", function BoardComponent_div_1_Template_div_click_3_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.deleteBoard());\n    });\n    i0.ɵɵtext(4, \"Delete board\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"div\", 5);\n    i0.ɵɵtemplate(6, BoardComponent_div_1_div_6_Template, 6, 4, \"div\", 6);\n    i0.ɵɵelementStart(7, \"inline-form\", 7);\n    i0.ɵɵlistener(\"handleSubmit\", function BoardComponent_div_1_Template_inline_form_handleSubmit_7_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.createColumn($event));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const data_r1 = ctx.ngIf;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"defaultText\", data_r1.board.title)(\"title\", data_r1.board.title);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", data_r1.columns);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"hasButton\", true);\n  }\n}\n\nexport class BoardComponent {\n  constructor(boardsService, route, router, boardService, socketService, columnsService, tasksService) {\n    this.boardsService = boardsService;\n    this.route = route;\n    this.router = router;\n    this.boardService = boardService;\n    this.socketService = socketService;\n    this.columnsService = columnsService;\n    this.tasksService = tasksService;\n    this.unsubscribe$ = new Subject();\n    const boardId = this.route.snapshot.paramMap.get('boardId');\n\n    if (!boardId) {\n      throw new Error('Cant get boardID from url');\n    }\n\n    this.boardId = boardId;\n    this.data$ = combineLatest([this.boardService.board$.pipe(filter(Boolean)), this.boardService.columns$, this.boardService.tasks$]).pipe(map(([board, columns, tasks]) => ({\n      board,\n      columns,\n      tasks\n    })));\n  }\n\n  ngOnInit() {\n    this.socketService.emit(SocketEventsEnum.boardsJoin, {\n      boardId: this.boardId\n    });\n    this.fetchData();\n    this.initializeListeners();\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  initializeListeners() {\n    this.router.events.subscribe(event => {\n      if (event instanceof NavigationStart && !event.url.includes('/boards/')) {\n        console.log('Leave board');\n        this.boardService.leaveBoard(this.boardId);\n      }\n    });\n    this.socketService.listen(SocketEventsEnum.columnsCreateSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(column => {\n      this.boardService.addColumn(column);\n    });\n    this.socketService.listen(SocketEventsEnum.columnsDeleteSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(columnId => {\n      this.boardService.deleteColumn(columnId);\n    });\n    this.socketService.listen(SocketEventsEnum.tasksCreateSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(task => {\n      this.boardService.addTask(task);\n    });\n    this.socketService.listen(SocketEventsEnum.boardsUpdateSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(updatedBoard => {\n      this.boardService.updateBoard(updatedBoard);\n    });\n    this.socketService.listen(SocketEventsEnum.columnsUpdateSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(updatedColumn => {\n      this.boardService.updateColumn(updatedColumn);\n    });\n    this.socketService.listen(SocketEventsEnum.columnsUpdateSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(updatedColumn => {\n      this.boardService.updateColumn(updatedColumn);\n    });\n    this.socketService.listen(SocketEventsEnum.boardsDeleteSuccess).pipe(takeUntil(this.unsubscribe$)).subscribe(() => {\n      this.router.navigateByUrl('/boards');\n    });\n  }\n\n  fetchData() {\n    this.boardsService.getBoard(this.boardId).subscribe(board => {\n      this.boardService.setBoard(board);\n    });\n    this.columnsService.getColumns(this.boardId).subscribe(columns => {\n      this.boardService.setColumns(columns);\n    });\n    this.tasksService.getTasks(this.boardId).subscribe(tasks => {\n      this.boardService.setTasks(tasks);\n    });\n  }\n\n  createColumn(title) {\n    const columnInput = {\n      title,\n      boardId: this.boardId\n    };\n    this.columnsService.createColumn(columnInput);\n  }\n\n  createTask(title, columnId) {\n    const taskInput = {\n      title,\n      boardId: this.boardId,\n      columnId\n    };\n    this.tasksService.createTask(taskInput);\n  }\n\n  getTasksByColumn(columnId, tasks) {\n    return tasks.filter(task => task.columnId === columnId);\n  }\n\n  updateBoardName(boardName) {\n    this.boardsService.updateBoard(this.boardId, {\n      title: boardName\n    });\n  }\n\n  deleteBoard() {\n    if (confirm('Are you sure you want to delete the board?')) {\n      this.boardsService.deleteBoard(this.boardId);\n    }\n  }\n\n  deleteColumn(columnId) {\n    this.columnsService.deleteColumn(this.boardId, columnId);\n  }\n\n  updateColumnName(columnName, columnId) {\n    this.columnsService.updateColumn(this.boardId, columnId, {\n      title: columnName\n    });\n  }\n\n  openTask(taskId) {\n    this.router.navigate(['boards', this.boardId, 'tasks', taskId]);\n  }\n\n}\n\nBoardComponent.ɵfac = function BoardComponent_Factory(t) {\n  return new (t || BoardComponent)(i0.ɵɵdirectiveInject(i1.BoardsService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.BoardService), i0.ɵɵdirectiveInject(i4.SocketService), i0.ɵɵdirectiveInject(i5.ColumnsService), i0.ɵɵdirectiveInject(i6.TasksService));\n};\n\nBoardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: BoardComponent,\n  selectors: [[\"board\"]],\n  decls: 4,\n  vars: 3,\n  consts: [[\"class\", \"board\", 4, \"ngIf\"], [1, \"board\"], [1, \"board-header-container\"], [1, \"edit-board-form\", 3, \"defaultText\", \"title\", \"handleSubmit\"], [1, \"delete-board\", 3, \"click\"], [1, \"columns\"], [\"class\", \"column\", 4, \"ngFor\", \"ngForOf\"], [\"defaultText\", \"Add a list\", \"buttonText\", \"Add list\", \"inputPlaceholder\", \"Add column name\", 1, \"create-column-form\", 3, \"hasButton\", \"handleSubmit\"], [1, \"column\"], [1, \"column-title\"], [1, \"edit-column-form\", 3, \"defaultText\", \"title\", \"handleSubmit\"], [\"src\", \"/assets/close_icon.svg\", 1, \"column-delete-icon\", 3, \"click\"], [\"class\", \"task\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"defaultText\", \"Add a card\", \"buttonText\", \"Add card\", \"inputPlaceholder\", \"Enter a title for this card\", 1, \"create-task-form\", 3, \"hasButton\", \"handleSubmit\"], [1, \"task\", 3, \"click\"]],\n  template: function BoardComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelement(0, \"app-topbar\");\n      i0.ɵɵtemplate(1, BoardComponent_div_1_Template, 8, 4, \"div\", 0);\n      i0.ɵɵpipe(2, \"async\");\n      i0.ɵɵelement(3, \"router-outlet\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 1, ctx.data$));\n    }\n  },\n  dependencies: [i7.NgForOf, i7.NgIf, i2.RouterOutlet, i8.TopbarComponent, i9.InlineFormComponent, i7.AsyncPipe],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"AACA,SAAyBA,eAAzB,QAAwD,iBAAxD;AACA,SAASC,aAAT,EAAwBC,MAAxB,EAAgCC,GAAhC,EAAiDC,OAAjD,EAA0DC,SAA1D,QAA2E,MAA3E;AAQA,SAASC,gBAAT,QAAiC,wCAAjC;;;;;;;;;;;;;;;;ICiBMC;IAGEA;MAAA;MAAA;MAAA;MAAA,OAASA,2CAAT;IAA0B,CAA1B;IAEAA;IACFA;;;;;IADEA;IAAAA;;;;;;;;IAnBJA,+BAAwD,CAAxD,EAAwD,KAAxD,EAAwD,CAAxD,EAAwD,CAAxD,EAAwD,aAAxD,EAAwD,EAAxD;IAMMA;MAAA;MAAA;MAAA;MAAA,OAAgBA,6DAAhB;IAAmD,CAAnD;IACDA;IACDA;IAGEA;MAAA;MAAA;MAAA;MAAA,OAASA,kDAAT;IAAgC,CAAhC;IAHFA;IAMFA;IAOAA;IAMEA;MAAA;MAAA;MAAA;MAAA,OAAgBA,wDAAhB;IAA6C,CAA7C;IACDA;;;;;;;IAxBGA;IAAAA,8CAA4B,OAA5B,EAA4BC,eAA5B;IAWeD;IAAAA;IASjBA;IAAAA;;;;;;;;IAnCRA,+BAAiD,CAAjD,EAAiD,KAAjD,EAAiD,CAAjD,EAAiD,CAAjD,EAAiD,aAAjD,EAAiD,CAAjD;IAMMA;MAAAA;MAAA;MAAA,OAAgBA,+CAAhB;IAAuC,CAAvC;IACDA;IACDA;IAA0BA;MAAAA;MAAA;MAAA,OAASA,qCAAT;IAAsB,CAAtB;IAAwBA;IAAYA;IAEhEA;IACEA;IA8BAA;IAMEA;MAAAA;MAAA;MAAA,OAAgBA,4CAAhB;IAAoC,CAApC;IACDA;;;;;IA5CCA;IAAAA,kDAAgC,OAAhC,EAAgCE,mBAAhC;IAOqCF;IAAAA;IAiCrCA;IAAAA;;;;AD3BN,OAAM,MAAOG,cAAP,CAAqB;EASzBC,YACUC,aADV,EAEUC,KAFV,EAGUC,MAHV,EAIUC,YAJV,EAKUC,aALV,EAMUC,cANV,EAOUC,YAPV,EAOoC;IAN1B;IACA;IACA;IACA;IACA;IACA;IACA;IATV,oBAAe,IAAId,OAAJ,EAAf;IAWE,MAAMe,OAAO,GAAG,KAAKN,KAAL,CAAWO,QAAX,CAAoBC,QAApB,CAA6BC,GAA7B,CAAiC,SAAjC,CAAhB;;IAEA,IAAI,CAACH,OAAL,EAAc;MACZ,MAAM,IAAII,KAAJ,CAAU,2BAAV,CAAN;IACD;;IAED,KAAKJ,OAAL,GAAeA,OAAf;IACA,KAAKK,KAAL,GAAavB,aAAa,CAAC,CACzB,KAAKc,YAAL,CAAkBU,MAAlB,CAAyBC,IAAzB,CAA8BxB,MAAM,CAACyB,OAAD,CAApC,CADyB,EAEzB,KAAKZ,YAAL,CAAkBa,QAFO,EAGzB,KAAKb,YAAL,CAAkBc,MAHO,CAAD,CAAb,CAIVH,IAJU,CAKXvB,GAAG,CAAC,CAAC,CAAC2B,KAAD,EAAQC,OAAR,EAAiBC,KAAjB,CAAD,MAA8B;MAChCF,KADgC;MAEhCC,OAFgC;MAGhCC;IAHgC,CAA9B,CAAD,CALQ,CAAb;EAWD;;EAEDC,QAAQ;IACN,KAAKjB,aAAL,CAAmBkB,IAAnB,CAAwB5B,gBAAgB,CAAC6B,UAAzC,EAAqD;MACnDhB,OAAO,EAAE,KAAKA;IADqC,CAArD;IAGA,KAAKiB,SAAL;IACA,KAAKC,mBAAL;EACD;;EAEDC,WAAW;IACT,KAAKC,YAAL,CAAkBC,IAAlB;IACA,KAAKD,YAAL,CAAkBE,QAAlB;EACD;;EAEDJ,mBAAmB;IACjB,KAAKvB,MAAL,CAAY4B,MAAZ,CAAmBC,SAAnB,CAA8BC,KAAD,IAAU;MACrC,IAAIA,KAAK,YAAY5C,eAAjB,IAAoC,CAAC4C,KAAK,CAACC,GAAN,CAAUC,QAAV,CAAmB,UAAnB,CAAzC,EAAyE;QACvEC,OAAO,CAACC,GAAR,CAAY,aAAZ;QACA,KAAKjC,YAAL,CAAkBkC,UAAlB,CAA6B,KAAK9B,OAAlC;MACD;IACF,CALD;IAOA,KAAKH,aAAL,CACGkC,MADH,CAC2B5C,gBAAgB,CAAC6C,oBAD5C,EAEGzB,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGcS,MAAD,IAAW;MACpB,KAAKrC,YAAL,CAAkBsC,SAAlB,CAA4BD,MAA5B;IACD,CALH;IAOA,KAAKpC,aAAL,CACGkC,MADH,CACkB5C,gBAAgB,CAACgD,oBADnC,EAEG5B,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGcY,QAAD,IAAa;MACtB,KAAKxC,YAAL,CAAkByC,YAAlB,CAA+BD,QAA/B;IACD,CALH;IAOA,KAAKvC,aAAL,CACGkC,MADH,CACyB5C,gBAAgB,CAACmD,kBAD1C,EAEG/B,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGce,IAAD,IAAS;MAClB,KAAK3C,YAAL,CAAkB4C,OAAlB,CAA0BD,IAA1B;IACD,CALH;IAOA,KAAK1C,aAAL,CACGkC,MADH,CAC0B5C,gBAAgB,CAACsD,mBAD3C,EAEGlC,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGckB,YAAD,IAAiB;MAC1B,KAAK9C,YAAL,CAAkB+C,WAAlB,CAA8BD,YAA9B;IACD,CALH;IAOA,KAAK7C,aAAL,CACGkC,MADH,CAC2B5C,gBAAgB,CAACyD,oBAD5C,EAEGrC,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGcqB,aAAD,IAAkB;MAC3B,KAAKjD,YAAL,CAAkBkD,YAAlB,CAA+BD,aAA/B;IACD,CALH;IAOA,KAAKhD,aAAL,CACGkC,MADH,CACsB5C,gBAAgB,CAACyD,oBADvC,EAEGrC,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGcqB,aAAD,IAAkB;MAC3B,KAAKjD,YAAL,CAAkBkD,YAAlB,CAA+BD,aAA/B;IACD,CALH;IAOA,KAAKhD,aAAL,CACGkC,MADH,CACgB5C,gBAAgB,CAAC4D,mBADjC,EAEGxC,IAFH,CAEQrB,SAAS,CAAC,KAAKkC,YAAN,CAFjB,EAGGI,SAHH,CAGa,MAAK;MACd,KAAK7B,MAAL,CAAYqD,aAAZ,CAA0B,SAA1B;IACD,CALH;EAMD;;EAED/B,SAAS;IACP,KAAKxB,aAAL,CAAmBwD,QAAnB,CAA4B,KAAKjD,OAAjC,EAA0CwB,SAA1C,CAAqDb,KAAD,IAAU;MAC5D,KAAKf,YAAL,CAAkBsD,QAAlB,CAA2BvC,KAA3B;IACD,CAFD;IAGA,KAAKb,cAAL,CAAoBqD,UAApB,CAA+B,KAAKnD,OAApC,EAA6CwB,SAA7C,CAAwDZ,OAAD,IAAY;MACjE,KAAKhB,YAAL,CAAkBwD,UAAlB,CAA6BxC,OAA7B;IACD,CAFD;IAGA,KAAKb,YAAL,CAAkBsD,QAAlB,CAA2B,KAAKrD,OAAhC,EAAyCwB,SAAzC,CAAoDX,KAAD,IAAU;MAC3D,KAAKjB,YAAL,CAAkB0D,QAAlB,CAA2BzC,KAA3B;IACD,CAFD;EAGD;;EAED0C,YAAY,CAACC,KAAD,EAAc;IACxB,MAAMC,WAAW,GAAyB;MACxCD,KADwC;MAExCxD,OAAO,EAAE,KAAKA;IAF0B,CAA1C;IAIA,KAAKF,cAAL,CAAoByD,YAApB,CAAiCE,WAAjC;EACD;;EAEDC,UAAU,CAACF,KAAD,EAAgBpB,QAAhB,EAAgC;IACxC,MAAMuB,SAAS,GAAuB;MACpCH,KADoC;MAEpCxD,OAAO,EAAE,KAAKA,OAFsB;MAGpCoC;IAHoC,CAAtC;IAKA,KAAKrC,YAAL,CAAkB2D,UAAlB,CAA6BC,SAA7B;EACD;;EAEDC,gBAAgB,CAACxB,QAAD,EAAmBvB,KAAnB,EAAyC;IACvD,OAAOA,KAAK,CAAC9B,MAAN,CAAcwD,IAAD,IAAUA,IAAI,CAACH,QAAL,KAAkBA,QAAzC,CAAP;EACD;;EAEDyB,eAAe,CAACC,SAAD,EAAkB;IAC/B,KAAKrE,aAAL,CAAmBkD,WAAnB,CAA+B,KAAK3C,OAApC,EAA6C;MAAEwD,KAAK,EAAEM;IAAT,CAA7C;EACD;;EAEDC,WAAW;IACT,IAAIC,OAAO,CAAC,4CAAD,CAAX,EAA2D;MACzD,KAAKvE,aAAL,CAAmBsE,WAAnB,CAA+B,KAAK/D,OAApC;IACD;EACF;;EAEDqC,YAAY,CAACD,QAAD,EAAiB;IAC3B,KAAKtC,cAAL,CAAoBuC,YAApB,CAAiC,KAAKrC,OAAtC,EAA+CoC,QAA/C;EACD;;EAED6B,gBAAgB,CAACC,UAAD,EAAqB9B,QAArB,EAAqC;IACnD,KAAKtC,cAAL,CAAoBgD,YAApB,CAAiC,KAAK9C,OAAtC,EAA+CoC,QAA/C,EAAyD;MACvDoB,KAAK,EAAEU;IADgD,CAAzD;EAGD;;EAEDC,QAAQ,CAACC,MAAD,EAAe;IACrB,KAAKzE,MAAL,CAAY0E,QAAZ,CAAqB,CAAC,QAAD,EAAW,KAAKrE,OAAhB,EAAyB,OAAzB,EAAkCoE,MAAlC,CAArB;EACD;;AApKwB;;;mBAAd7E,gBAAcH;AAAA;;;QAAdG;EAAc+E;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MCnB3BtF;MAEAA;;MAoDAA;;;;MApDoBA;MAAAA","names":["NavigationStart","combineLatest","filter","map","Subject","takeUntil","SocketEventsEnum","i0","column_r3","data_r1","BoardComponent","constructor","boardsService","route","router","boardService","socketService","columnsService","tasksService","boardId","snapshot","paramMap","get","Error","data$","board$","pipe","Boolean","columns$","tasks$","board","columns","tasks","ngOnInit","emit","boardsJoin","fetchData","initializeListeners","ngOnDestroy","unsubscribe$","next","complete","events","subscribe","event","url","includes","console","log","leaveBoard","listen","columnsCreateSuccess","column","addColumn","columnsDeleteSuccess","columnId","deleteColumn","tasksCreateSuccess","task","addTask","boardsUpdateSuccess","updatedBoard","updateBoard","columnsUpdateSuccess","updatedColumn","updateColumn","boardsDeleteSuccess","navigateByUrl","getBoard","setBoard","getColumns","setColumns","getTasks","setTasks","createColumn","title","columnInput","createTask","taskInput","getTasksByColumn","updateBoardName","boardName","deleteBoard","confirm","updateColumnName","columnName","openTask","taskId","navigate","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["/home/ct/Documents/fullstack-trello-clone/eltrello/client/src/app/board/components/board/board.component.ts","/home/ct/Documents/fullstack-trello-clone/eltrello/client/src/app/board/components/board/board.component.html"],"sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { ActivatedRoute, NavigationStart, Router } from '@angular/router';\nimport { combineLatest, filter, map, Observable, Subject, takeUntil } from 'rxjs';\nimport { BoardsService } from 'src/app/shared/services/boards.service';\nimport { ColumnsService } from 'src/app/shared/services/columns.service';\nimport { SocketService } from 'src/app/shared/services/socket.service';\nimport { TasksService } from 'src/app/shared/services/tasks.service';\nimport { BoardInterface } from 'src/app/shared/types/board.interface';\nimport { ColumnInterface } from 'src/app/shared/types/column.interface';\nimport { ColumnInputInterface } from 'src/app/shared/types/columnInput.interface';\nimport { SocketEventsEnum } from 'src/app/shared/types/socketEvents.enum';\nimport { TaskInterface } from 'src/app/shared/types/task.interface';\nimport { TaskInputInterface } from 'src/app/shared/types/taskInput.interface';\nimport { BoardService } from '../../services/board.service';\n\n@Component({\n  selector: 'board',\n  templateUrl: './board.component.html',\n})\nexport class BoardComponent implements OnInit, OnDestroy {\n  boardId: string;\n  data$: Observable<{\n    board: BoardInterface;\n    columns: ColumnInterface[];\n    tasks: TaskInterface[];\n  }>;\n  unsubscribe$ = new Subject<void>();\n\n  constructor(\n    private boardsService: BoardsService,\n    private route: ActivatedRoute,\n    private router: Router,\n    private boardService: BoardService,\n    private socketService: SocketService,\n    private columnsService: ColumnsService,\n    private tasksService: TasksService\n  ) {\n    const boardId = this.route.snapshot.paramMap.get('boardId');\n\n    if (!boardId) {\n      throw new Error('Cant get boardID from url');\n    }\n\n    this.boardId = boardId;\n    this.data$ = combineLatest([\n      this.boardService.board$.pipe(filter(Boolean)),\n      this.boardService.columns$,\n      this.boardService.tasks$,\n    ]).pipe(\n      map(([board, columns, tasks]) => ({\n        board,\n        columns,\n        tasks,\n      }))\n    );\n  }\n\n  ngOnInit(): void {\n    this.socketService.emit(SocketEventsEnum.boardsJoin, {\n      boardId: this.boardId,\n    });\n    this.fetchData();\n    this.initializeListeners();\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  initializeListeners(): void {\n    this.router.events.subscribe((event) => {\n      if (event instanceof NavigationStart && !event.url.includes('/boards/')) {\n        console.log('Leave board');\n        this.boardService.leaveBoard(this.boardId);\n      }\n    });\n\n    this.socketService\n      .listen<ColumnInterface>(SocketEventsEnum.columnsCreateSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((column) => {\n        this.boardService.addColumn(column);\n      });\n\n    this.socketService\n      .listen<string>(SocketEventsEnum.columnsDeleteSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((columnId) => {\n        this.boardService.deleteColumn(columnId);\n      });\n\n    this.socketService\n      .listen<TaskInterface>(SocketEventsEnum.tasksCreateSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((task) => {\n        this.boardService.addTask(task);\n      });\n\n    this.socketService\n      .listen<BoardInterface>(SocketEventsEnum.boardsUpdateSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((updatedBoard) => {\n        this.boardService.updateBoard(updatedBoard);\n      });\n\n    this.socketService\n      .listen<ColumnInterface>(SocketEventsEnum.columnsUpdateSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((updatedColumn) => {\n        this.boardService.updateColumn(updatedColumn);\n      });\n      \n    this.socketService\n      .listen<CInterface>(SocketEventsEnum.columnsUpdateSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((updatedColumn) => {\n        this.boardService.updateColumn(updatedColumn);\n      });\n\n    this.socketService\n      .listen<void>(SocketEventsEnum.boardsDeleteSuccess)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.router.navigateByUrl('/boards');\n      });\n  }\n\n  fetchData(): void {\n    this.boardsService.getBoard(this.boardId).subscribe((board) => {\n      this.boardService.setBoard(board);\n    });\n    this.columnsService.getColumns(this.boardId).subscribe((columns) => {\n      this.boardService.setColumns(columns);\n    });\n    this.tasksService.getTasks(this.boardId).subscribe((tasks) => {\n      this.boardService.setTasks(tasks);\n    });\n  }\n\n  createColumn(title: string): void {\n    const columnInput: ColumnInputInterface = {\n      title,\n      boardId: this.boardId,\n    };\n    this.columnsService.createColumn(columnInput);\n  }\n\n  createTask(title: string, columnId: string): void {\n    const taskInput: TaskInputInterface = {\n      title,\n      boardId: this.boardId,\n      columnId,\n    };\n    this.tasksService.createTask(taskInput);\n  }\n\n  getTasksByColumn(columnId: string, tasks: TaskInterface[]): TaskInterface[] {\n    return tasks.filter((task) => task.columnId === columnId);\n  }\n\n  updateBoardName(boardName: string): void {\n    this.boardsService.updateBoard(this.boardId, { title: boardName });\n  }\n\n  deleteBoard(): void {\n    if (confirm('Are you sure you want to delete the board?')) {\n      this.boardsService.deleteBoard(this.boardId);\n    }\n  }\n\n  deleteColumn(columnId: string): void {\n    this.columnsService.deleteColumn(this.boardId, columnId);\n  }\n\n  updateColumnName(columnName: string, columnId: string): void {\n    this.columnsService.updateColumn(this.boardId, columnId, {\n      title: columnName,\n    });\n  }\n\n  openTask(taskId: string): void {\n    this.router.navigate(['boards', this.boardId, 'tasks', taskId]);\n  }\n}","<app-topbar></app-topbar>\n\n<div class=\"board\" *ngIf=\"data$ | async as data\">\n  <div class=\"board-header-container\">\n    <inline-form\n      class=\"edit-board-form\"\n      [defaultText]=\"data.board.title\"\n      [title]=\"data.board.title\"\n      (handleSubmit)=\"updateBoardName($event)\"\n    ></inline-form>\n    <div class=\"delete-board\" (click)=\"deleteBoard()\">Delete board</div>\n  </div>\n  <div class=\"columns\">\n    <div class=\"column\" *ngFor=\"let column of data.columns\">\n      <div class=\"column-title\">\n        <inline-form\n          class=\"edit-column-form\"\n          [defaultText]=\"column.title\"\n          [title]=\"column.title\"\n          (handleSubmit)=\"updateColumnName($event, column.id)\"\n        ></inline-form>\n        <img\n          src=\"/assets/close_icon.svg\"\n          class=\"column-delete-icon\"\n          (click)=\"deleteColumn(column.id)\"\n        />\n      </div>\n      <div\n        *ngFor=\"let task of getTasksByColumn(column.id, data.tasks)\"\n        class=\"task\"\n        (click)=\"openTask(task.id)\"\n      >\n        {{ task.title }}\n      </div>\n      <inline-form\n        class=\"create-task-form\"\n        defaultText=\"Add a card\"\n        [hasButton]=\"true\"\n        buttonText=\"Add card\"\n        inputPlaceholder=\"Enter a title for this card\"\n        (handleSubmit)=\"createTask($event, column.id)\"\n      ></inline-form>\n    </div>\n    <inline-form\n      class=\"create-column-form\"\n      defaultText=\"Add a list\"\n      [hasButton]=\"true\"\n      buttonText=\"Add list\"\n      inputPlaceholder=\"Add column name\"\n      (handleSubmit)=\"createColumn($event)\"\n    ></inline-form>\n  </div>\n</div>\n\n<router-outlet></router-outlet>"]},"metadata":{},"sourceType":"module"}